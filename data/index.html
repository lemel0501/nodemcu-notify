<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>IoT æ™ºæ…§ç›£æ¸¬æ§åˆ¶ç³»çµ±</title>
<style>
  :root{
    --ink:#0e2a1a;          /* ä¸»å­—è‰² */
    --muted:#54745f;        /* æ¬¡è¦å­—è‰² */
    --bg1:#f6fff3;          /* èƒŒæ™¯å±¤ */
    --bg2:#ffffff;          /* å¡ç‰‡åº•è‰² */
    --brand:#1e7f53;        /* å“ç‰Œè‰² */
    --brand-weak:#1e7f531a; /* å“ç‰Œæ·¡è‰² */
    --ring:#1e7f5340;       /* èšç„¦å¤–æ¡† */
    --border:#0e2a1a22;     /* é‚Šæ¡†è‰² */
    --shadow:0 10px 24px rgba(14,42,26,.10), 0 2px 8px rgba(14,42,26,.06);
    --radius:16px;
    --gap:14px;
  }
  html,body{height:100%}
  body{
    margin:0; padding:20px; line-height:1.6; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans TC", sans-serif;
    color:var(--ink);
    background: radial-gradient(1200px 800px at 10% -10%, #dfffe0, transparent 60%),
                radial-gradient(1200px 800px at 110% 30%, #eaffd7, transparent 60%),
                linear-gradient(180deg, #f9fff7 0%, #f4fff1 100%);
  }
  .container{max-width:1100px;margin:0 auto}
  /* â”€â”€ é ‚éƒ¨è³‡è¨Šåˆ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .topbar{
    position:sticky; top:0; z-index:20; margin:-10px -10px 16px; padding:14px 18px;
    background: rgba(255,255,255,.75); backdrop-filter:saturate(140%) blur(6px);
    border:1px solid var(--border); border-radius:12px; box-shadow: var(--shadow);
    display:flex; align-items:center; justify-content:space-between; gap:12px;
  }
  .brand{display:flex; align-items:center; gap:10px}
  .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#31b574,#1e7f53); box-shadow:inset 0 0 0 2px #fff8}
  .title{margin:0}
  .pills{display:flex; flex-wrap:wrap; gap:8px}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:.35rem .6rem; border-radius:999px;
        background:var(--brand-weak); color:var(--ink); font-size:14px; border:1px solid var(--border)}
  .code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}

  /* â”€â”€ å¡ç‰‡èˆ‡è¡¨å–® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  h2,h3,h4{margin:.2em 0 .5em}
  h3{display:flex; align-items:center; gap:.5em}
  .card{background:var(--bg2); border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow)}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
  .span-2{grid-column:1/-1}
  label{display:block; margin:.3rem 0 .35rem; font-weight:600}
  small{color:var(--muted)}
  input,button,textarea,select{
    font-size:16px; width:100%; box-sizing:border-box;
    padding:10px 12px; border-radius:12px; border:1px solid var(--border);
    background:#fff; color:var(--ink); outline:none;
  }
  input:focus, textarea:focus, select:focus{ box-shadow:0 0 0 3px var(--ring); border-color:var(--brand) }
  .btn{ cursor:pointer; background:var(--brand); color:#fff; border:none; font-weight:700 }
  .btn.ghost{ background:#fff; color:var(--brand); border:1px solid var(--brand) }
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .row2{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
  @media (max-width:860px){ .grid{grid-template-columns:1fr} .row2{grid-template-columns:1fr} }

  /* æ˜ŸæœŸ checkbox â†’ è† å›ŠæŒ‰éˆ• */
  .weekday-wrap{ display:flex; flex-wrap:wrap; gap:10px }
  .wbtn{ position:relative; display:inline-flex; align-items:center; gap:.5em; padding:.45rem .8rem; border-radius:999px; border:1px solid var(--border); background:#fff; user-select:none }
  .wbtn input{ position:absolute; inset:0; opacity:0 }
  .wbtn:has(input:checked){ background:var(--brand); color:#fff; border-color:transparent }

  /* sticky å„²å­˜åˆ— */
  .savebar{ position:sticky; bottom:0; z-index:10; margin-top:14px; }
  .savebar .inner{ display:flex; gap:10px; justify-content:flex-end; align-items:center;
    background: rgba(255,255,255,.85); border:1px solid var(--border); border-radius:12px; padding:10px; backdrop-filter: blur(6px); box-shadow: var(--shadow) }

  /* è¼•é‡è¡¨æ ¼å…©æ¬„ï¼šæ¨™ç±¤+æ¬„ä½ */
  .twocol{ display:grid; grid-template-columns: 200px 1fr; gap:10px; align-items:center }
  @media (max-width:680px){ .twocol{grid-template-columns:1fr} }

  /* ç´°ç¯€å¾®èª¿ */
  .muted{ color:var(--muted) }
  hr{ border:0; border-top:1px dashed var(--border); margin:18px 0 }
</style>
</head>
<body>
  <div class="container">
    <div class="topbar" role="banner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 class="title">==IoT æ™ºæ…§ç›£æ¸¬æ§åˆ¶ç³»çµ±== </h1>
          <div class="muted" style="font-size:13px">YQ IoT Notify</div>
        </div>
      </div>
      <div class="pills">
        <span class="pill">IPï¼š<span class="code">{{IP}}</span></span>
        <span class="pill">RTCï¼š<span class="code" id="rtcSnap">{{NOW}}</span></span>
      </div>
    </div>

    <!-- å„²å­˜è¨­å®šï¼ˆPOST /saveï¼‰ -->
    <form method="POST" action="/save" id="mainForm" novalidate>

      <!-- åªåœ¨ AP æ¨¡å¼é¡¯ç¤ºï¼›STA ç”±ä¸‹æ–¹è…³æœ¬ç›´æ¥å¾ DOM ç§»é™¤ -->
      <section class="card secrets span-2" aria-label="Wiâ€‘Fi èˆ‡ Telegram">
        <h3>ğŸ“¶ Wiâ€‘Fi / ğŸ¤– Telegram</h3>
        <div class="grid">
          <div>
            <label for="ssid">Wiâ€‘Fi SSID</label>
            <input id="ssid" name="ssid" value="{{SSID}}" autocomplete="off">
            <label for="pass">Wiâ€‘Fi Password</label>
            <input id="pass" name="pass" value="{{PASS}}" autocomplete="off">
          </div>
          <div>
            <label for="token">Telegram Bot Token</label>
            <input id="token" name="token" value="{{TOKEN}}" autocomplete="off">
            <label for="chat">Telegram Chat ID</label>
            <input id="chat" name="chat" value="{{CHAT}}" autocomplete="off">
            <label for="so">è¢å¹•ä¿è­·ï¼ˆç§’ï¼Œ0=åœç”¨ï¼‰(Optional)</label>
            <input id="so" name="so" type="number" min="0" max="7200" value="{{SCREEN_OFF}}">
          </div>
        </div>
      </section>

      <!-- æœ‰æ•ˆæ˜ŸæœŸ -->
      <section class="card span-2">
        <h3>ğŸ“… æœ‰æ•ˆæ˜ŸæœŸ</h3>
        <div class="weekday-wrap" role="group" aria-label="é¸æ“‡è¦ç”Ÿæ•ˆçš„æ˜ŸæœŸå¹¾">
          <label class="wbtn"><input type="checkbox" name="wd0" {{WD0}}>é€±ä¸€</label>
          <label class="wbtn"><input type="checkbox" name="wd1" {{WD1}}>é€±äºŒ</label>
          <label class="wbtn"><input type="checkbox" name="wd2" {{WD2}}>é€±ä¸‰</label>
          <label class="wbtn"><input type="checkbox" name="wd3" {{WD3}}>é€±å››</label>
          <label class="wbtn"><input type="checkbox" name="wd4" {{WD4}}>é€±äº”</label>
          <label class="wbtn"><input type="checkbox" name="wd5" {{WD5}}>é€±å…­</label>
          <label class="wbtn"><input type="checkbox" name="wd6" {{WD6}}>é€±æ—¥</label>
        </div>
        <small>æœªå‹¾é¸çš„æ—¥å­ï¼Œå®šæ™‚èˆ‡ã€Œå·¥ä»¶æ¯æ—¥æ¨æ’­ã€éƒ½ä¸æœƒè¢«å•Ÿå‹•ã€‚</small>
      </section>

      <!-- å®šæ™‚æ’ç¨‹ -->
      <section class="span-2">
        <h3>â±ï¸ å®šæ™‚æ’ç¨‹è¨­ç½®</h3>
        <div class="grid">
          <!-- 6 è·¯é‡è¤‡å€å¡Šï¼šä¿ç•™ç›¸åŒæ¬„ä½åç¨±ï¼Œä¸å‹•å¾Œç«¯ -->
          <!-- CH1 -->
          <div class="card">
            <h4>ç¬¬ 1 è·¯</h4>
            <label>å®šæ™‚è¨­å®š (HH:MM)</label>
            <input name="t0" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="08:30" value="{{T0}}">
            <label>ä¿æŒæ™‚é–“</label>
            <div class="row2">
              <div><input name="hm0" type="number" min="0" max="600" value="{{HM0}}"><small>åˆ†</small></div>
              <div><input name="hs0" type="number" min="0" max="59"  value="{{HS0}}"><small>ç§’ï¼ˆæœ€å¤§ 3600 ç§’ï¼‰</small></div>
            </div>
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="mon0" value="{{MON0}}">
            <p><button class="btn" type="button" onclick="testRelay(0)">æ¸¬è©¦æ­¤è·¯åŠŸèƒ½</button></p>
          </div>
          <!-- CH2 -->
          <div class="card">
            <h4>ç¬¬ 2 è·¯</h4>
            <label>å®šæ™‚è¨­å®š (HH:MM)</label>
            <input name="t1" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="08:30" value="{{T1}}">
            <label>ä¿æŒæ™‚é–“</label>
            <div class="row2">
              <div><input name="hm1" type="number" min="0" max="600" value="{{HM1}}"><small>åˆ†</small></div>
              <div><input name="hs1" type="number" min="0" max="59"  value="{{HS1}}"><small>ç§’ï¼ˆæœ€å¤§ 3600 ç§’ï¼‰</small></div>
            </div>
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="mon1" value="{{MON1}}">
            <p><button class="btn" type="button" onclick="testRelay(1)">æ¸¬è©¦æ­¤è·¯åŠŸèƒ½</button></p>
          </div>
          <!-- CH3 -->
          <div class="card">
            <h4>ç¬¬ 3 è·¯</h4>
            <label>å®šæ™‚è¨­å®š (HH:MM)</label>
            <input name="t2" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="08:30" value="{{T2}}">
            <label>ä¿æŒæ™‚é–“</label>
            <div class="row2">
              <div><input name="hm2" type="number" min="0" max="600" value="{{HM2}}"><small>åˆ†</small></div>
              <div><input name="hs2" type="number" min="0" max="59"  value="{{HS2}}"><small>ç§’ï¼ˆæœ€å¤§ 3600 ç§’ï¼‰</small></div>
            </div>
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="mon2" value="{{MON2}}">
            <p><button class="btn" type="button" onclick="testRelay(2)">æ¸¬è©¦æ­¤è·¯åŠŸèƒ½</button></p>
          </div>
          <!-- CH4 -->
          <div class="card">
            <h4>ç¬¬ 4 è·¯</h4>
            <label>å®šæ™‚è¨­å®š (HH:MM)</label>
            <input name="t3" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="08:30" value="{{T3}}">
            <label>ä¿æŒæ™‚é–“</label>
            <div class="row2">
              <div><input name="hm3" type="number" min="0" max="600" value="{{HM3}}"><small>åˆ†</small></div>
              <div><input name="hs3" type="number" min="0" max="59"  value="{{HS3}}"><small>ç§’ï¼ˆæœ€å¤§ 3600 ç§’ï¼‰</small></div>
            </div>
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="mon3" value="{{MON3}}">
            <p><button class="btn" type="button" onclick="testRelay(3)">æ¸¬è©¦æ­¤è·¯åŠŸèƒ½</button></p>
          </div>
          <!-- CH5 -->
          <div class="card">
            <h4>ç¬¬ 5 è·¯</h4>
            <label>å®šæ™‚è¨­å®š (HH:MM)</label>
            <input name="t4" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="08:30" value="{{T4}}">
            <label>ä¿æŒæ™‚é–“</label>
            <div class="row2">
              <div><input name="hm4" type="number" min="0" max="600" value="{{HM4}}"><small>åˆ†</small></div>
              <div><input name="hs4" type="number" min="0" max="59"  value="{{HS4}}"><small>ç§’ï¼ˆæœ€å¤§ 3600 ç§’ï¼‰</small></div>
            </div>
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="mon4" value="{{MON4}}">
            <p><button class="btn" type="button" onclick="testRelay(4)">æ¸¬è©¦æ­¤è·¯åŠŸèƒ½</button></p>
          </div>
          <!-- CH6 -->
          <div class="card">
            <h4>ç¬¬ 6 è·¯</h4>
            <label>å®šæ™‚è¨­å®š (HH:MM)</label>
            <input name="t5" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="08:30" value="{{T5}}">
            <label>ä¿æŒæ™‚é–“</label>
            <div class="row2">
              <div><input name="hm5" type="number" min="0" max="600" value="{{HM5}}"><small>åˆ†</small></div>
              <div><input name="hs5" type="number" min="0" max="59"  value="{{HS5}}"><small>ç§’ï¼ˆæœ€å¤§ 3600 ç§’ï¼‰</small></div>
            </div>
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="mon5" value="{{MON5}}">
            <p><button class="btn" type="button" onclick="testRelay(5)">æ¸¬è©¦æ­¤è·¯åŠŸèƒ½</button></p>
          </div>

          <!-- ç•°å¸¸æ¨æ’­ï¼šèªªæ˜å¡ç‰‡ -->
          <div class="card span-2">
            <h3>âš ï¸ ç•°å¸¸æ¨æ’­è¨Šæ¯è¨­ç½®</h3>
            <small>èªªæ˜ï¼šè¨Šè™Ÿçš„æœ‰æ•ˆæ²¿ï¼ˆç”± OFF è½‰ç‚º ONï¼‰ç‚ºæ¨æ’­äº‹ä»¶çš„è§¸ç™¼æ¢ä»¶ï¼ŒæŒçºŒ ON ç‹€æ…‹ä¸é‡è¤‡è§¸ç™¼ã€‚</small>
          </div>

          <!-- 6 è·¯ç•°å¸¸æ¨æ’­è¨Šæ¯æ¬„ä½ï¼ˆä¿ç•™åç¨±ï¼‰ -->
          <div class="card"><h4>ç¬¬ä¸€è·¯</h4><label>æ¨æ’­è¨Šæ¯</label><input name="am0" value="{{AM0}}"></div>
          <div class="card"><h4>ç¬¬äºŒè·¯</h4><label>æ¨æ’­è¨Šæ¯</label><input name="am1" value="{{AM1}}"></div>
          <div class="card"><h4>ç¬¬ä¸‰è·¯</h4><label>æ¨æ’­è¨Šæ¯</label><input name="am2" value="{{AM2}}"></div>
          <div class="card"><h4>ç¬¬å››è·¯</h4><label>æ¨æ’­è¨Šæ¯</label><input name="am3" value="{{AM3}}"></div>
          <div class="card"><h4>ç¬¬äº”è·¯</h4><label>æ¨æ’­è¨Šæ¯</label><input name="am4" value="{{AM4}}"></div>
          <div class="card"><h4>ç¬¬å…­è·¯</h4><label>æ¨æ’­è¨Šæ¯</label><input name="am5" value="{{AM5}}"></div>
        </div>
      </section>

      <!-- å·¥ä»¶è¨ˆæ•¸ï¼šå…©çµ„ -->
      <section class="span-2">
        <div class="card span-2" style="margin-bottom:var(--gap)">
          <h3>ğŸ§® è¨ˆæ•¸å™¨æ¨¡å¼</h3>
          <small>æ¯è§¸ç™¼ä¸€æ¬¡å³ +1ï¼Œæ¨æ’­å¾Œè‡ªå‹•æ¸…é›¶ã€‚(æ•¸é‡ç‚º0å‰‡ä¸æ¨æ’­)</small>
        </div>
        <div class="grid">
<!-- è¨ˆæ•¸å™¨ #1ï¼ˆæ–°å¢é”æ¨™é–€æª»æ¬„ä½ï¼‰ -->
<div class="card">
  <h4>è¨ˆæ•¸å™¨ #1</h4>
  <label>æ¨æ’­è¨Šæ¯</label>
  <input name="cm0" value="{{CM0}}">

  <!-- â˜… æ–°å¢ï¼šé”æ¨™é–€æª» -->
  <label>é”æ¨™é–€æª»ï¼ˆä»¶æ•¸ï¼Œ0=åœç”¨é”æ¨™æ¨¡å¼ï¼‰</label>
  <input name="cn0" type="number" min="0" step="1" value="{{CN0}}">
  <small class="muted">>0 æ™‚ï¼šè¨ˆæ•¸å™¨æ¡ã€Œé”æ¨™å³æ¨æ’­ã€æ¨¡å¼ï¼Œä¸åšæ¯æ—¥æ™‚é–“å›å ±ã€‚</small>

  <p><button class="btn ghost" type="button" onclick="resetCnt(0)">æ‰‹å‹•æ¸…é›¶</button></p>
</div>

          <div class="card">
            <h4>è¨ˆæ•¸å™¨ #2</h4>
            <label>å®šæ™‚æ¯æ—¥æ¨æ’­æ™‚é–“ (HH:MM)</label>
            <input name="ct1" inputmode="numeric" pattern="^\d{1,2}:\d{2}$" placeholder="17:30" value="{{CT1}}">
            <label>æ¨æ’­è¨Šæ¯</label>
            <input name="cm1" value="{{CM1}}">
            <p><button class="btn ghost" type="button" onclick="resetCnt(1)">æ‰‹å‹•æ¸…é›¶</button></p>
          </div>
        </div>
      </section>
        <div class="savebar">
          <div class="inner">
            <button class="btn" type="submit">ğŸ’¾ å„²å­˜è¨­å®š</button>
          </div>
        </div>
      </section>
    </form>

    <hr>

    <!-- æ ¡æ™‚ï¼ˆPOST /set-timeï¼‰ -->
    <section class="card span-2" aria-label="è‡ªå‹•æ ¡æ™‚">
      <h3>ğŸ•’ è‡ªå‹•æ ¡æ™‚</h3>
      <form method="POST" action="/set-time" class="twocol">
        <label for="when">ç¾åœ¨æ™‚é–“ï¼ˆYYYY-MM-DD HH:MMï¼‰</label>
        <div style="display:flex; gap:10px; align-items:center">
          <input id="when" name="when" value="{{NOW}}">
          <button class="btn" type="submit">å¯«å…¥æ™‚é˜</button>
          <button class="btn ghost" type="button" id="snapNow">å¥—ç”¨æ­¤åˆ»</button>
        </div>
      </form>
      <p class="muted" style="margin:.6rem 0 0">æ³¨æ„:æœ‰å‚™ä»½é›»æ± æ‰æœƒåœ¨æ–·é›»æ™‚æŒçºŒèµ°æ™‚ã€‚</p>
    </section>
  </div>

<script>
async function testRelay(ch){
  try{
    const r = await fetch('/test-relay?ch='+ch);
    const t = await r.text();
    alert(t);
  }catch(e){ alert('æ¸¬è©¦å¤±æ•—ï¼š'+e); }
}
async function resetCnt(ch){
  try{
    const r = await fetch('/count-reset?ch='+ch, {method:'POST'});
    const t = await r.text();
    alert('è¨ˆæ•¸å™¨ #'+(ch+1)+' å·²æ¸…é›¶ï¼š'+t);
  }catch(e){ alert('æ¸…é›¶å¤±æ•—ï¼š'+e); }
}
// AP/STAï¼šåªåœ¨ AP æ¨¡å¼é¡¯ç¤ºæ©Ÿæ•å€å¡Š
(function(){
  var show = '{{SHOW_SECRETS}}' === '1';
  document.querySelectorAll('.secrets').forEach(function(card){ if(!show) card.remove(); });
})();
// æ ¡æ™‚ï¼šæŠŠæ­¤åˆ»æ™‚é–“å¥—å…¥è¼¸å…¥æ¡†
(function(){
  const btn = document.getElementById('snapNow');
  if(!btn) return;
  btn.addEventListener('click', function(){
    const d = new Date();
    const pad = n=> String(n).padStart(2,'0');
    const v = d.getFullYear()+ '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate()) + ' ' + pad(d.getHours()) + ':' + pad(d.getMinutes());
    const inp = document.getElementById('when');
    if (inp) inp.value = v;
    const rtc = document.getElementById('rtcSnap');
    if (rtc) rtc.textContent = v;
  });
})();
// ç°¡æ˜“ HH:MM è‡ªå‹•è£œé›¶ï¼ˆä¸æ›´å‹•å¾Œç«¯æ¬„ä½åç¨±ï¼‰
(function(){
  document.querySelectorAll('input[pattern^="^\\d"]').forEach(function(inp){
    inp.addEventListener('blur', function(){
      let s = (inp.value||'').trim();
      if(!s) return;
      const m = s.match(/^(\d{1,2}):(\d{1,2})$/);
      if(!m) return; // äº¤çµ¦å¾Œç«¯é©—è­‰
      let h = Math.min(23, Math.max(0, Number(m[1])));
      let mm = Math.min(59, Math.max(0, Number(m[2])));
      inp.value = String(h).padStart(2,'0')+':'+String(mm).padStart(2,'0');
    });
  });
})();
</script>
</body>
</html>
